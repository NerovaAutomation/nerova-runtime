<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scroll Sandbox</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#0f1222; color:#eaeef9; margin:0; }
    .wrap { max-width: 820px; margin: 0 auto; padding: 16px; }
    h1 { margin: 0 0 12px; font-size: 18px; }
    .row { display:flex; gap:8px; align-items:center; margin:6px 0; flex-wrap: wrap; }
    button, input { padding:8px; border-radius:6px; border:1px solid #334; background:#161b38; color:#dbe3ff; }
    button { background:#2a3cff; border-color:#2a3cff; cursor:pointer; }
    button:hover { filter:brightness(1.1); }
    pre { background:#0b0e1a; border:1px solid #334; border-radius:6px; padding:8px; max-height:320px; overflow:auto; }
    .hint { opacity:.8; font-size:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Scroll Sandbox</h1>
    <div class="row">
      <button id="btnScrollAll">Scroll Everything (Optimal)</button>
      <button id="btnScrollUniversal">Scroll Everything (Universal)</button>
      <span class="hint">Unified main + containers + iframes (fast)</span>
    </div>
    <h3>Log</h3>
    <pre id="log"></pre>
  </div>
  <script>
    const ws = new WebSocket((location.protocol === 'https:' ? 'wss://' : 'ws://') + location.host);
    const logEl = document.getElementById('log');
    function log(msg){ try { const t = new Date().toLocaleTimeString(); logEl.textContent = `[${t}] ${msg}\n` + logEl.textContent; } catch {} }
    function send(obj){ try { ws.send(JSON.stringify(obj)); } catch (e) { log('WS send error: ' + (e.message||e)); } }

    ws.addEventListener('open', () => log('WebSocket connected'));
    ws.addEventListener('close', () => log('WebSocket closed'));
    ws.addEventListener('error', (e) => log('WebSocket error'));
    ws.addEventListener('message', (ev) => {
      try {
        const m = JSON.parse(ev.data);
        if (m && m.type === 'NAVIGATED') log(`Navigated → ${m.url || ''}`);
        if (m && m.type === 'SCROLLED') log(`Scrolled ${m.direction || ''} → ${m.verified && m.verified.ok ? 'ok' : 'unverified'}`);
        if (m && m.type === 'SCROLL_DEBUG' && m.phase === 'END') log(`Scroll finished (${m.direction || ''})`);
      } catch {}
    });

    document.getElementById('btnScrollAll').onclick = () => {
      // Ensure browser is focused, then trigger the unified scroll
      send({ type:'FOCUS' });
      setTimeout(() => {
        const token = 'sb-' + Date.now().toString(36);
        send({ type: 'SCROLL_BOTH', direction: 'down', token });
      }, 80);
    };
    document.getElementById('btnScrollUniversal').onclick = () => {
      send({ type:'FOCUS' });
      setTimeout(() => {
        send({ type: 'SCROLL_UNIVERSAL', direction: 'down' });
      }, 80);
    };
  </script>
</body>
</html>
